# Brainworks Property management software

### Project Structure

- `/client`: all the front end, currently only have `/webapp`
- `/server`: backend

### Pre-requisite

- Node v22
- Postgres 16

### Tech stack

- Vite / React
- Node / Express
- Drizzle / Postgres
- npm (package manager)

### Backend Code structure

- 3 layer architecture
  - Route
    - all the api routes
  - Controller
    - it can be also call handler
    - no buisness logic should be in controller
    - should be used as an ochestation, directing different request to different services
  - Service
    - contain all the buisness logic
  - DAL ( Data Access Layer)
    - DAO or DTO can be store here
    - since this is a set of standalone functions for db queries, calling DAL will be easier because DTO and DAO are both objects
- feature grouping

##### File and Folder structure in server

```
├── api
│   ├── [featureName]
│   |   ├── routes.ts         // all the different routes belongs to the
│   |   ├── controller.ts     // Orchestration ( get request from routes and assigned to different services)
│   |   ├── service.ts        // all the buisness logic feature
│   |   ├── dal.ts            // data access layer - for DAO and DTO
│   │   ├── type.ts           // all the types used in the feature
├── middleware                              // general middlware (i.e auth)
├── utils                                   // general utills functions
├── tests
│   ├── [feature].test.ts                   // testing the services file for each feature
├── db
│   ├── schema                              // all the model from database
│   ├── index.js
│   ├── migrations                          // all migration files generated by drizzle
├── index.ts
└──
```

### How to launch the app

1. Set up database and add database url in env file (only do once)
2. install packages in both client and server folder with `npm install`
3. run `npm run dev`
   - it will trigger front and backend with concurrently

### How to create migration

- Option 1: `npx drizzle-kit push` (do both generate and migrate)

- Option 2: `npx drizzle-kit generate` then `npx drizzle-kit migrate`

## Testing - Draft

- The test will not be using Mocks
- Test will be written with Jest
- Only services layer of each feature will be tested
- there are 2 types of validation
  - Data validation: validate inputs
    - i.e. The format of password is wrong
    - i.e name is empty
    - all the following type of validaiton will be handle either in controller layer or middleware, so no testing required
  - Business Logic Validation: these are the business logic requirements
    - i.e Resident can only registered if the access code is correct
    - these are the logic that will be stored in services level
    - test this logic as there are part of the behaviour
- Stubs will be use to for almost all of the testing
  - Some of the functionally in services layer will involve calling a 3rd party sources or persistence layer such as database
  - Even we organize code in different functions, but they are not pure, so it will be hard to test. Stub will be used
  - We will be create stub for DAL layer

### Coding Guidelines (Server)

test github
